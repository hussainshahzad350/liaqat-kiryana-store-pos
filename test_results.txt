00:00 +0: loading C:/src/project/liaqat-kiryana-store-pos/test/unit/purchase_repository_test.dart
00:00 +0: (setUpAll)
00:00 +0: PurchaseRepository.cancelPurchase should cancel purchase when sufficient stock exists
Γ£à [DB] ΓÜá∩╕Å Wiping and Recreating Database...
Γ£à [DB] Database file deleted: C:\src\project\liaqat-kiryana-store-pos\.dart_tool\sqflite_common_ffi\databases\liaqat_store.db
≡ƒùä∩╕Å Creating Database v1...
≡ƒùä∩╕Å Sample data inserted
≡ƒùä∩╕Å Database created successfully
≡ƒùä∩╕Å Database successfully reset and recreated.
00:00 +0 -1: PurchaseRepository.cancelPurchase should cancel purchase when sufficient stock exists [E]
  SqfliteFfiException(sqlite_error: 1, , SqliteException(1): while preparing statement, table stock_activities has no column named batch_number, SQL logic error (code 1)
    Causing statement: INSERT INTO stock_activities (product_id, quantity_change, transaction_type, reference_type, reference_id, batch_number, expiry_date, user, created_at) VALUES (?, ?, ?, ?, ?, NULL, NULL, ?, ?)}) DatabaseException(SqliteException(1): while preparing statement, table stock_activities has no column named batch_number, SQL logic error (code 1)
    Causing statement: INSERT INTO stock_activities (product_id, quantity_change, transaction_type, reference_type, reference_id, batch_number, expiry_date, user, created_at) VALUES (?, ?, ?, ?, ?, NULL, NULL, ?, ?)) sql 'INSERT INTO stock_activities (product_id, quantity_change, transaction_type, reference_type, reference_id, batch_number, expiry_date, user, created_at) VALUES (?, ?, ?, ?, ?, NULL, NULL, ?, ?)' args [1, 10.0, PURCHASE, PURCHASE, 1, SYSTEM, 2026-02-10T22:00:20.296740] {details: {database: {path: C:\src\project\liaqat-kiryana-store-pos\.dart_tool\sqflite_common_ffi\databases\liaqat_store.db, id: 1, readOnly: false, singleInstance: true}}}
  package:sqflite_common_ffi/src/method_call.dart 125:9  responseToResultOrThrow
  package:sqflite_common_ffi/src/isolate.dart 35:12      SqfliteIsolate.handle
  
00:00 +0 -1: PurchaseRepository.cancelPurchase should throw exception when cancellation would cause negative stock
Γ£à [DB] ΓÜá∩╕Å Wiping and Recreating Database...
Γ£à [DB] Database file deleted: C:\src\project\liaqat-kiryana-store-pos\.dart_tool\sqflite_common_ffi\databases\liaqat_store.db
≡ƒùä∩╕Å Creating Database v1...
≡ƒùä∩╕Å Sample data inserted
≡ƒùä∩╕Å Database created successfully
≡ƒùä∩╕Å Database successfully reset and recreated.
00:00 +0 -2: PurchaseRepository.cancelPurchase should throw exception when cancellation would cause negative stock [E]
  SqfliteFfiException(sqlite_error: 1, , SqliteException(1): while preparing statement, table stock_activities has no column named batch_number, SQL logic error (code 1)
    Causing statement: INSERT INTO stock_activities (product_id, quantity_change, transaction_type, reference_type, reference_id, batch_number, expiry_date, user, created_at) VALUES (?, ?, ?, ?, ?, NULL, NULL, ?, ?)}) DatabaseException(SqliteException(1): while preparing statement, table stock_activities has no column named batch_number, SQL logic error (code 1)
    Causing statement: INSERT INTO stock_activities (product_id, quantity_change, transaction_type, reference_type, reference_id, batch_number, expiry_date, user, created_at) VALUES (?, ?, ?, ?, ?, NULL, NULL, ?, ?)) sql 'INSERT INTO stock_activities (product_id, quantity_change, transaction_type, reference_type, reference_id, batch_number, expiry_date, user, created_at) VALUES (?, ?, ?, ?, ?, NULL, NULL, ?, ?)' args [1, 20.0, PURCHASE, PURCHASE, 1, SYSTEM, 2026-02-10T22:00:20.442391] {details: {database: {path: C:\src\project\liaqat-kiryana-store-pos\.dart_tool\sqflite_common_ffi\databases\liaqat_store.db, id: 2, readOnly: false, singleInstance: true}}}
  package:sqflite_common_ffi/src/method_call.dart 125:9  responseToResultOrThrow
  package:sqflite_common_ffi/src/isolate.dart 35:12      SqfliteIsolate.handle
  
00:00 +0 -2: PurchaseRepository.cancelPurchase should throw exception for already cancelled purchase
Γ£à [DB] ΓÜá∩╕Å Wiping and Recreating Database...
Γ£à [DB] Database file deleted: C:\src\project\liaqat-kiryana-store-pos\.dart_tool\sqflite_common_ffi\databases\liaqat_store.db
≡ƒùä∩╕Å Creating Database v1...
≡ƒùä∩╕Å Sample data inserted
≡ƒùä∩╕Å Database created successfully
≡ƒùä∩╕Å Database successfully reset and recreated.
00:00 +0 -3: PurchaseRepository.cancelPurchase should throw exception for already cancelled purchase [E]
  SqfliteFfiException(sqlite_error: 1, , SqliteException(1): while preparing statement, table stock_activities has no column named batch_number, SQL logic error (code 1)
    Causing statement: INSERT INTO stock_activities (product_id, quantity_change, transaction_type, reference_type, reference_id, batch_number, expiry_date, user, created_at) VALUES (?, ?, ?, ?, ?, NULL, NULL, ?, ?)}) DatabaseException(SqliteException(1): while preparing statement, table stock_activities has no column named batch_number, SQL logic error (code 1)
    Causing statement: INSERT INTO stock_activities (product_id, quantity_change, transaction_type, reference_type, reference_id, batch_number, expiry_date, user, created_at) VALUES (?, ?, ?, ?, ?, NULL, NULL, ?, ?)) sql 'INSERT INTO stock_activities (product_id, quantity_change, transaction_type, reference_type, reference_id, batch_number, expiry_date, user, created_at) VALUES (?, ?, ?, ?, ?, NULL, NULL, ?, ?)' args [1, 5.0, PURCHASE, PURCHASE, 1, SYSTEM, 2026-02-10T22:00:20.499474] {details: {database: {path: C:\src\project\liaqat-kiryana-store-pos\.dart_tool\sqflite_common_ffi\databases\liaqat_store.db, id: 3, readOnly: false, singleInstance: true}}}
  package:sqflite_common_ffi/src/method_call.dart 125:9  responseToResultOrThrow
  package:sqflite_common_ffi/src/isolate.dart 35:12      SqfliteIsolate.handle
  
00:00 +0 -3: PurchaseRepository.cancelPurchase should throw exception for non-existent purchase
Γ£à [DB] ΓÜá∩╕Å Wiping and Recreating Database...
Γ£à [DB] Database file deleted: C:\src\project\liaqat-kiryana-store-pos\.dart_tool\sqflite_common_ffi\databases\liaqat_store.db
≡ƒùä∩╕Å Creating Database v1...
≡ƒùä∩╕Å Sample data inserted
≡ƒùä∩╕Å Database created successfully
≡ƒùä∩╕Å Database successfully reset and recreated.
00:00 +1 -3: PurchaseRepository.cancelPurchase should provide helpful error message with product name
Γ£à [DB] ΓÜá∩╕Å Wiping and Recreating Database...
Γ£à [DB] Database file deleted: C:\src\project\liaqat-kiryana-store-pos\.dart_tool\sqflite_common_ffi\databases\liaqat_store.db
≡ƒùä∩╕Å Creating Database v1...
≡ƒùä∩╕Å Sample data inserted
≡ƒùä∩╕Å Database created successfully
≡ƒùä∩╕Å Database successfully reset and recreated.
00:00 +1 -4: PurchaseRepository.cancelPurchase should provide helpful error message with product name [E]
  SqfliteFfiException(sqlite_error: 1, , SqliteException(1): while preparing statement, table stock_activities has no column named batch_number, SQL logic error (code 1)
    Causing statement: INSERT INTO stock_activities (product_id, quantity_change, transaction_type, reference_type, reference_id, batch_number, expiry_date, user, created_at) VALUES (?, ?, ?, ?, ?, NULL, NULL, ?, ?)}) DatabaseException(SqliteException(1): while preparing statement, table stock_activities has no column named batch_number, SQL logic error (code 1)
    Causing statement: INSERT INTO stock_activities (product_id, quantity_change, transaction_type, reference_type, reference_id, batch_number, expiry_date, user, created_at) VALUES (?, ?, ?, ?, ?, NULL, NULL, ?, ?)) sql 'INSERT INTO stock_activities (product_id, quantity_change, transaction_type, reference_type, reference_id, batch_number, expiry_date, user, created_at) VALUES (?, ?, ?, ?, ?, NULL, NULL, ?, ?)' args [1, 100.0, PURCHASE, PURCHASE, 1, SYSTEM, 2026-02-10T22:00:20.620350] {details: {database: {path: C:\src\project\liaqat-kiryana-store-pos\.dart_tool\sqflite_common_ffi\databases\liaqat_store.db, id: 5, readOnly: false, singleInstance: true}}}
  package:sqflite_common_ffi/src/method_call.dart 125:9  responseToResultOrThrow
  package:sqflite_common_ffi/src/isolate.dart 35:12      SqfliteIsolate.handle
  
00:00 +1 -4: PurchaseRepository.cancelPurchase should validate all items before making any changes
Γ£à [DB] ΓÜá∩╕Å Wiping and Recreating Database...
Γ£à [DB] Database file deleted: C:\src\project\liaqat-kiryana-store-pos\.dart_tool\sqflite_common_ffi\databases\liaqat_store.db
≡ƒùä∩╕Å Creating Database v1...
≡ƒùä∩╕Å Sample data inserted
≡ƒùä∩╕Å Database created successfully
≡ƒùä∩╕Å Database successfully reset and recreated.
00:00 +1 -5: PurchaseRepository.cancelPurchase should validate all items before making any changes [E]
  SqfliteFfiException(sqlite_error: 1, , SqliteException(1): while preparing statement, table stock_activities has no column named batch_number, SQL logic error (code 1)
    Causing statement: INSERT INTO stock_activities (product_id, quantity_change, transaction_type, reference_type, reference_id, batch_number, expiry_date, user, created_at) VALUES (?, ?, ?, ?, ?, NULL, NULL, ?, ?)}) DatabaseException(SqliteException(1): while preparing statement, table stock_activities has no column named batch_number, SQL logic error (code 1)
    Causing statement: INSERT INTO stock_activities (product_id, quantity_change, transaction_type, reference_type, reference_id, batch_number, expiry_date, user, created_at) VALUES (?, ?, ?, ?, ?, NULL, NULL, ?, ?)) sql 'INSERT INTO stock_activities (product_id, quantity_change, transaction_type, reference_type, reference_id, batch_number, expiry_date, user, created_at) VALUES (?, ?, ?, ?, ?, NULL, NULL, ?, ?)' args [1, 10.0, PURCHASE, PURCHASE, 1, SYSTEM, 2026-02-10T22:00:20.680589] {details: {database: {path: C:\src\project\liaqat-kiryana-store-pos\.dart_tool\sqflite_common_ffi\databases\liaqat_store.db, id: 6, readOnly: false, singleInstance: true}}}
  package:sqflite_common_ffi/src/method_call.dart 125:9  responseToResultOrThrow
  package:sqflite_common_ffi/src/isolate.dart 35:12      SqfliteIsolate.handle
  
00:00 +1 -5: PurchaseRepository.createPurchase should create purchase and update stock
Γ£à [DB] ΓÜá∩╕Å Wiping and Recreating Database...
Γ£à [DB] Database file deleted: C:\src\project\liaqat-kiryana-store-pos\.dart_tool\sqflite_common_ffi\databases\liaqat_store.db
≡ƒùä∩╕Å Creating Database v1...
≡ƒùä∩╕Å Sample data inserted
≡ƒùä∩╕Å Database created successfully
≡ƒùä∩╕Å Database successfully reset and recreated.
00:00 +1 -6: PurchaseRepository.createPurchase should create purchase and update stock [E]
  SqfliteFfiException(sqlite_error: 1, , SqliteException(1): while preparing statement, table stock_activities has no column named batch_number, SQL logic error (code 1)
    Causing statement: INSERT INTO stock_activities (product_id, quantity_change, transaction_type, reference_type, reference_id, batch_number, expiry_date, user, created_at) VALUES (?, ?, ?, ?, ?, NULL, NULL, ?, ?)}) DatabaseException(SqliteException(1): while preparing statement, table stock_activities has no column named batch_number, SQL logic error (code 1)
    Causing statement: INSERT INTO stock_activities (product_id, quantity_change, transaction_type, reference_type, reference_id, batch_number, expiry_date, user, created_at) VALUES (?, ?, ?, ?, ?, NULL, NULL, ?, ?)) sql 'INSERT INTO stock_activities (product_id, quantity_change, transaction_type, reference_type, reference_id, batch_number, expiry_date, user, created_at) VALUES (?, ?, ?, ?, ?, NULL, NULL, ?, ?)' args [1, 5.0, PURCHASE, PURCHASE, 1, SYSTEM, 2026-02-10T22:00:20.725685] {details: {database: {path: C:\src\project\liaqat-kiryana-store-pos\.dart_tool\sqflite_common_ffi\databases\liaqat_store.db, id: 7, readOnly: false, singleInstance: true}}}
  package:sqflite_common_ffi/src/method_call.dart 125:9  responseToResultOrThrow
  package:sqflite_common_ffi/src/isolate.dart 35:12      SqfliteIsolate.handle
  
00:00 +1 -6: (tearDownAll)
00:00 +1 -6: Some tests failed.
